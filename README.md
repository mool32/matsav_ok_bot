# ü§ñ Telegram-–±–æ—Ç "–ú–∞—Ü–∞–≤ –¢–æ–≤"

> –ë–æ—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ª—é–¥–µ–π –≤ —Å–ª–æ–∂–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞ —á–µ—Ä–µ–∑ –¥–æ–±—Ä—ã–µ, —á–µ–ª–æ–≤–µ—á–Ω—ã–µ —Ñ—Ä–∞–∑—ã

–¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–Ω–∞–Ω–æ–π –≤–µ—Ä—Å–∏–∏!!

## üìå –û–ø–∏—Å–∞–Ω–∏–µ 

"–ú–∞—Ü–∞–≤ –¢–æ–≤" (◊û◊¶◊ë ◊ò◊ï◊ë - "—Ö–æ—Ä–æ—à–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ") - —ç—Ç–æ Telegram-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π:
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ —Ñ—Ä–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –°–æ–±–∏—Ä–∞–µ—Ç –¥–æ–±—Ä—ã–µ —Å–ª–æ–≤–∞ –æ—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ 
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç "–ø–æ—Ä—Ü–∏–∏ —Ç–µ–ø–ª–∞" 4 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å
- –ò–º–µ–µ—Ç —Å–∏—Å—Ç–µ–º—É –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏ –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- üåû **–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Ä—Ü–∏—é —Ç–µ–ø–ª–∞** - —Å–ª—É—á–∞–π–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è —Ñ—Ä–∞–∑–∞
- üíå **–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–µ–π —Ñ—Ä–∞–∑–æ–π** - –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ —Å–ª–æ–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- üì± **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - 4 —Ä–∞—Å—Å—ã–ª–∫–∏ –≤ –¥–µ–Ω—å –≤ —Å–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞** (`/admin`) 
- üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (`/test_notification`)
- üîÑ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–æ–π** (`/reschedule`)
- üìù **–ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ñ—Ä–∞–∑** (`/moderate`, `/approve_all`)
- üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** (`/security`)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
matsav_tov_bot/
‚îú‚îÄ‚îÄ main_fixed.py              # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ config.py                  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ bot_handlers_fixed.py      # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ database.py                # –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ scheduler.py               # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
‚îú‚îÄ‚îÄ moderation.py              # –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ security.py                # –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
‚îú‚îÄ‚îÄ requirements.txt           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ data/                      # –î–∞–Ω–Ω—ã–µ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ phrases.txt           # –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã
‚îÇ   ‚îú‚îÄ‚îÄ user_phrases.csv      # –§—Ä–∞–∑—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ users.txt             # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ security.json         # –î–∞–Ω–Ω—ã–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ logs/                      # –õ–æ–≥–∏
    ‚îî‚îÄ‚îÄ bot.log               # –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
```

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É
mkdir matsav_tov_bot
cd matsav_tov_bot

# –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞** –æ—Ç @BotFather –≤ Telegram
2. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.py`**:
   ```python
   BOT_TOKEN = "–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨"
   ADMIN_ID = –í–ê–®_TELEGRAM_ID
   ```

### 3. –ó–∞–ø—É—Å–∫

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
python3 main_fixed.py
```

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º

### –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:

**–û—Å–Ω–æ–≤–Ω—ã–µ:**
- `/admin` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞
- `/test_notification` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- `/reschedule` - –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫–∏

**–ú–æ–¥–µ—Ä–∞—Ü–∏—è:**
- `/moderate` - –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ—Ä–∞–∑ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- `/stats_moderation` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- `/approve_all` - –æ–¥–æ–±—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã –ø–∞–∫–µ—Ç–Ω–æ

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- `/security` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ñ—Ä–∞–∑:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è** - —Ñ—Ä–∞–∑—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Å–ø–∞–º –∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
2. **–†—É—á–Ω–∞—è** - –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ —Ñ–∞–π–ª `data/user_phrases.csv`
3. **–ü–∞–∫–µ—Ç–Ω–∞—è** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/approve_all` –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ß–∞—Å—Ç–æ—Ç–∞ —Ä–∞—Å—Å—ã–ª–æ–∫
–í `config.py` –∏–∑–º–µ–Ω–∏—Ç–µ:
```python
DAILY_NOTIFICATIONS = 4  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—Å—Å—ã–ª–æ–∫ –≤ –¥–µ–Ω—å
```

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
–í `scheduler.py` –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Ä–µ–º—è —Ä–∞—Å—Å—ã–ª–æ–∫:
```python
time_slots = [
    (9, 11),   # –£—Ç—Ä–æ: 9:00-11:00
    (12, 14),  # –û–±–µ–¥: 12:00-14:00
    (15, 17),  # –î–µ–Ω—å: 15:00-17:00
    (18, 20),  # –í–µ—á–µ—Ä: 18:00-20:00
]
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–í `security.py` –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–∏–º–∏—Ç—ã:
```python
rate_limits = {
    'messages_per_hour': 10,
    'phrases_per_day': 3,
    'commands_per_minute': 5
}
```

## üåê –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### VPS/Dedicated —Å–µ—Ä–≤–µ—Ä:

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.9+**
2. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ systemd —Å–µ—Ä–≤–∏—Å**:

```ini
# /etc/systemd/system/matsav-tov.service
[Unit]
Description=Matsav Tov Telegram Bot
After=network.target

[Service]
Type=simple
User=bot
WorkingDirectory=/path/to/matsav_tov_bot
Environment=PATH=/path/to/matsav_tov_bot/venv/bin
ExecStart=/path/to/matsav_tov_bot/venv/bin/python main_fixed.py
Restart=always

[Install]
WantedBy=multi-user.target
```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å**:
```bash
sudo systemctl enable matsav-tov
sudo systemctl start matsav-tov
```

### –û–±–ª–∞—á–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:

**Railway:**
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (BOT_TOKEN, ADMIN_ID)
3. –î–µ–ø–ª–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**Heroku:**
1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –î–æ–±–∞–≤—å—Ç–µ buildpack Python
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ Procfile: `worker: python main_fixed.py`

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `logs/bot.log`:
- –†–∞—Å—Å—ã–ª–∫–∏ –∏ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –§–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö
- `data/phrases.txt` - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏
- `data/user_phrases.csv` - —Ñ—Ä–∞–∑—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- `data/users.txt` - —Å–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `data/security.json` - –¥–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ë–æ—Ç –≤–∫–ª—é—á–∞–µ—Ç:
- **Rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** —Å–ø–∞–º–∞ –∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **–°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∞—É–¥–∏—Ç–∞

## üîÑ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø—ã:
```bash
# –ê—Ä—Ö–∏–≤–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É data
tar -czf backup_$(date +%Y%m%d).tar.gz data/

# –ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã
cp data/phrases.txt backups/
cp data/user_phrases.csv backups/
cp data/users.txt backups/
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `logs/bot.log`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –≤ –ø–∞–ø–∫–µ `data/`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ª—é–¥–µ–π –≤ —Ç—Ä—É–¥–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å –¥–æ–±—Ä–æ—Ç–æ–π! ‚ú®

---

*◊û◊¶◊ë ◊ò◊ï◊ë - –ø—É—Å—Ç—å —É –≤—Å–µ—Ö –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ* ‚ù§Ô∏è